<!DOCTYPE html>
<html lang="en" class="dark-theme">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign In - AquaDex</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}" />
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #00334e;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .signin-box {
      background: #fff;
      color: #333;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      width: 350px;
      text-align: center;
      position: relative;
    }
    .signin-box h2 {
      margin-bottom: 20px;
      color: #002a44;
    }
    .signin-box input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .password-wrapper {
      position: relative;
    }
    .password-wrapper input {
      padding-right: 40px;
    }
    .toggle-password {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      fill: #002a44;
      transition: fill 0.3s ease;
    }
    .toggle-password:hover {
      fill: #014d73;
    }
    .remember-me {
      display: flex;
      align-items: center;
      font-size: 14px;
      margin: 10px 0 20px;
      text-align: left;
      gap: 8px;
      color: #333;
      justify-content: flex-start;
      width: fit-content;
    }
    .remember-me input[type="checkbox"] {
      margin: 0;
      cursor: pointer;
    }
    .remember-me label {
      white-space: nowrap;
    }
    .signin-box button[type="submit"] {
      background: #002a44;
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    .signin-box button[type="submit"]:hover:not(:disabled) {
      background: #014d73;
    }
    .signin-box button[type="submit"]:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .signin-box p {
      margin-top: 15px;
      font-size: 14px;
    }
    .create-link {
      color: #00bcd4;
      text-decoration: none;
    }
    .create-link:hover {
      text-decoration: underline;
    }
    .welcome-msg {
      color: green;
      font-size: 14px;
      margin-top: 10px;
    }
    .back-home {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 15px;
      background: #002a44;
      color: #fff;
      text-decoration: none;
      border-radius: 6px;
      transition: 0.3s;
    }
    .back-home:hover {
      background: #014d73;
    }
  </style>
</head>
<body>
  <div class="signin-box">
    <h2>Sign In</h2>
    <form id="signinForm">
      <input type="text" id="username" placeholder="Email or Username" required />

      <!-- Password with visibility toggle -->
      <div class="password-wrapper">
        <input type="password" id="password" placeholder="Password" required />
        <button type="button" class="toggle-password" aria-label="Toggle Password Visibility" onclick="togglePassword()">
          <!-- Eye icon SVG for "Show" -->
          <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
            <circle cx="12" cy="12" r="2.5"/>
          </svg>
        </button>
      </div>

      <!-- Remember Me Checkbox -->
      <div class="remember-me">
        <input type="checkbox" id="rememberMe" />
        <label for="rememberMe">Remember Me</label>
      </div>

      <button type="submit">Sign In</button>
      <div id="welcome" class="welcome-msg"></div>
    </form>

    <p>Don't have an account? <a href="{{ url_for('signup') }}" class="create-link">Create one</a></p>
    <a href="{{ url_for('index') }}" class="back-home">â¬… Back to Home</a>
  </div>

  <script>
    const form = document.getElementById("signinForm");
    const welcomeDiv = document.getElementById("welcome");
    const rememberCheckbox = document.getElementById("rememberMe");
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const eyeIcon = document.getElementById("eyeIcon");

    // Load saved username on page load
    window.onload = function () {
      const savedUsername = localStorage.getItem("rememberedUser");
      if (savedUsername) {
        usernameInput.value = savedUsername;
        rememberCheckbox.checked = true;
      }
    };

    form.addEventListener("submit", function (event) {
      event.preventDefault();

      const username = usernameInput.value.trim();

      // Save or remove remembered username
      if (rememberCheckbox.checked) {
        localStorage.setItem("rememberedUser", username);
      } else {
        localStorage.removeItem("rememberedUser");
      }

      // Save the user key for logged-in status
      localStorage.setItem("user", username);

      welcomeDiv.textContent = `Welcome, ${username}!`;

      // Disable the submit button to prevent multiple clicks
      form.querySelector("button[type='submit']").disabled = true;

      // Redirect after short delay
      setTimeout(() => {
        window.location.href = "{{ url_for('index') }}";
      }, 1500);
    });

    // Toggle password visibility and switch eye icon
    function togglePassword() {
      const isPassword = passwordInput.getAttribute("type") === "password";

      if (isPassword) {
        passwordInput.setAttribute("type", "text");
        // Change icon to eye closed
        eyeIcon.innerHTML = `
          <path d="M2 12s4-7 10-7c6 0 10 7 10 7s-4 7-10 7c-6 0-10-7-10-7zm10 3c-1.657 0-3-1.343-3-3 0-.796.328-1.522.854-2.04l4.186 4.186a2.99 2.99 0 0 1-2.04.854zm5.146-1.146l-4.186-4.186a2.992 2.992 0 0 1 2.04-.854c1.657 0 3 1.343 3 3 0 .796-.328 1.522-.854 2.04z"/>
        `;
      } else {
        passwordInput.setAttribute("type", "password");
        // Change icon to eye open
        eyeIcon.innerHTML = `
          <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
          <circle cx="12" cy="12" r="2.5"/>
        `;
      }
    }
  </script>
</body>
</html>